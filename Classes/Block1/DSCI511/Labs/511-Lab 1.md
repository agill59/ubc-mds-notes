

# Lab 1: Reading in and wrangling data

## Instructions

rubric={mechanics:5}

Check off that you have read and followed each of these instructions:

- [X] All files necessary to run your work must be pushed to your GitHub.ubc.ca repository for this lab.
- [X] You need to have a minimum of 3 commit messages associated with your GitHub.ubc.ca repository for this lab.
- [X] You must also submit `.ipynb` file and the rendered PDF in this worksheet/lab to Gradescope. Entire notebook must be executed so the TA's can see the results of your work.
- [X] **There is autograding in this lab, so please do not move or rename this file. Also, do not copy and paste cells, if you need to add new cells, create new cells via the "Insert a cell below" button instead.**
- [X] To ensure you do not break the autograder remove all code for installing packages (i.e., DO NOT have `! conda install ...` or `! pip install ...` in your homework!
- [X] Follow the [MDS general lab instructions](https://ubc-mds.github.io/resources_pages/general_lab_instructions/).
- [X] `<mark>`This lab has hidden tests. In this lab, the visible tests are just there to ensure you create an object with the correct name. The remaining tests are hidden intentionally. This is so you get practice deciding when you have written the correct code and created the correct data object. This is a necessary skill for data scientists, and if we were to provide robust visible tests for all questions you would not develop this skill, or at least not to its full potential.`</mark>`

## Code Quality

rubric={quality:5}

The code that you write for this assignment will be given one overall grade for code quality, see our code quality rubric as a guide to what we are looking for. Also, for this course (and other MDS courses that use R), we are trying to follow the PEP 8 code style. There is a guide you can refer too: https://peps.python.org/pep-0008/

Each code question will also be assessed for code accuracy (i.e., does it do what it is supposed to do?).

## Writing

rubric={writing:5}

To get the marks for this writing component, you should:

- Use proper English, spelling, and grammar throughout your submission (the non-coding parts).
- Be succinct. This means being specific about what you want to communicate, without being superfluous.

## Let's get started!

Run the cell below to load the packages needed for this lab.

```python
import pandas as pd
import numpy as np
import altair as alt
pd.set_option('display.max_rows', 6)
```

## Exercise 1: Reading in Data

Read the data files listed in the table below, and store them as pandas data frames with the names provided in the table. We will use hidden tests to grade this, so you will get to practice deciding that your job is done, and done correctly.

**Note - if the column names are missing from any data sets you need to add them yourself programmatically via python**

| File                     | Name for Data Frame | File location                                                                            |
| ------------------------ | ------------------- | ---------------------------------------------------------------------------------------- |
| `abbotsford_lang.xlsx` | `abbotsford`      | `data` directory of this repo                                                          |
| `calgary_lang.csv`     | `calgary`         | `data` directory of this repo                                                          |
| `edmonton_lang.xlsx`   | `edmonton`        | https://github.com/ttimbers/canlang/blob/master/inst/extdata/edmonton_lang.xlsx?raw=true |
| `kelowna_lang.csv`     | `kelowna`         | `data` directory of this repo                                                          |
| `vancouver_lang.csv`   | `vancouver`       | `data` directory of this repo                                                          |
| `victoria_lang.csv`    | `victoria`        | https://github.com/ttimbers/canlang/raw/master/inst/extdata/victoria_lang.tsv            |

### The Data

The data you will be working with in this first exercise is language data from the 2016 Canadian Census for cities in Western Canada. If you are unfamiliar with Western Canadian geography, hereâ€™s a map to help you start to get more familiar:

<img src="https://www.canadatours.com/images/maps/Canada_W.gif" width=500>

Image source: https://www.canadatours.com/canada_maps.cfm?#W

### Exercise 1.1: Read in the Abbotsford language Data

rubric={autograde:5}

```python
abbotsford = pd.read_excel("data/abbotsford_lang.xlsx", sheet_name="data")
abbotsford
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>5</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>135</td>
      <td>75</td>
      <td>0</td>
      <td>285</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>15</td>
      <td>5</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>20</td>
      <td>0</td>
      <td>0</td>
      <td>50</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_1")
```

<p><strong><pre style='display: inline;'>ex1_1</pre></strong> passed! ðŸŒŸ</p>

### Exercise 1.2: Read in the Calgary language Data

rubric={autograde:5}

```python
calgary = pd.read_csv("data/calgary_lang.csv")
calgary
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>20</td>
      <td>5</td>
      <td>0</td>
      <td>15</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>960</td>
      <td>505</td>
      <td>15</td>
      <td>1955</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>45</td>
      <td>15</td>
      <td>0</td>
      <td>170</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>380</td>
      <td>210</td>
      <td>0</td>
      <td>580</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>80</td>
      <td>10</td>
      <td>0</td>
      <td>175</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>1430</td>
      <td>350</td>
      <td>0</td>
      <td>3460</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_2")
```

<p><strong><pre style='display: inline;'>ex1_2</pre></strong> passed! ðŸ’¯</p>

### Exercise 1.3: Read in the Edmonton language Data

rubric={autograde:5}

```python
url = "https://github.com/ttimbers/canlang/blob/master/inst/extdata/edmonton_lang.xlsx?raw=true"
edmonton =  pd.read_excel(url, sheet_name="data")
edmonton
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>25</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>575</td>
      <td>300</td>
      <td>0</td>
      <td>1220</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>65</td>
      <td>20</td>
      <td>0</td>
      <td>155</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>235</td>
      <td>120</td>
      <td>0</td>
      <td>260</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>55</td>
      <td>0</td>
      <td>0</td>
      <td>65</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>700</td>
      <td>280</td>
      <td>0</td>
      <td>1600</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_3")
```

<p><strong><pre style='display: inline;'>ex1_3</pre></strong> passed! ðŸ’¯</p>

### Exercise 1.4: Read in the Kelowna language Data

rubric={autograde:5}

```python
names=edmonton.columns
names
```

    Index(['category', 'language', 'mother_tongue', 'most_at_home', 'most_at_work',
           'lang_known'],
          dtype='object')

```python
kelowna = pd.read_table("data/kelowna_lang.csv", delimiter=";", skiprows=[0,1,2,3,4,5,220],names=edmonton.columns)
kelowna
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>175</td>
      <td>75</td>
      <td>0</td>
      <td>280</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>5</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_4")
```

<p><strong><pre style='display: inline;'>ex1_4</pre></strong> passed! ðŸ’¯</p>

### Exercise 1.5: Read in the Vancouver language Data

rubric={autograde:5}

```python
vancouver = pd.read_csv("data/vancouver_lang.csv")
vancouver
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>70</td>
      <td>15</td>
      <td>0</td>
      <td>35</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>1435</td>
      <td>520</td>
      <td>10</td>
      <td>4225</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>45</td>
      <td>10</td>
      <td>0</td>
      <td>95</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>4330</td>
      <td>2495</td>
      <td>45</td>
      <td>5385</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>220</td>
      <td>10</td>
      <td>0</td>
      <td>385</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>190</td>
      <td>40</td>
      <td>0</td>
      <td>505</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_5")
```

<p><strong><pre style='display: inline;'>ex1_5</pre></strong> passed! ðŸŒŸ</p>

### Exercise 1.6: Read in the Victoria language Data

rubric={autograde:5}

```python
url = "https://github.com/ttimbers/canlang/raw/master/inst/extdata/victoria_lang.tsv"
victoria = pd.read_csv(url, sep = '\t')
victoria
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>category</th>
      <th>language</th>
      <th>mother_tongue</th>
      <th>most_at_home</th>
      <th>most_at_work</th>
      <th>lang_known</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Aboriginal languages</td>
      <td>Aboriginal languages, n.o.s.</td>
      <td>10</td>
      <td>0</td>
      <td>0</td>
      <td>25</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afrikaans</td>
      <td>175</td>
      <td>50</td>
      <td>0</td>
      <td>580</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Afro-Asiatic languages, n.i.e.</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>20</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>211</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Wu (Shanghainese)</td>
      <td>125</td>
      <td>65</td>
      <td>0</td>
      <td>135</td>
    </tr>
    <tr>
      <th>212</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yiddish</td>
      <td>35</td>
      <td>0</td>
      <td>0</td>
      <td>55</td>
    </tr>
    <tr>
      <th>213</th>
      <td>Non-Official & Non-Aboriginal languages</td>
      <td>Yoruba</td>
      <td>20</td>
      <td>0</td>
      <td>0</td>
      <td>90</td>
    </tr>
  </tbody>
</table>
<p>214 rows Ã— 6 columns</p>
</div>

```python
grader.check("ex1_6")
```

<p><strong><pre style='display: inline;'>ex1_6</pre></strong> passed! ðŸ’¯</p>

## Exercise 2: Basic Data Wrangling

rubric={autograde:10}

Read the file `region_lang.csv` (located in the `data` directory of this repo) into a pandas data frame. We will use this data frame to uncover the name of the Canadian census metropolitan area which has the second greatest number of people who claim that the language they speak most often at home is **Spanish**. Return the region name as a string and assign this string to a variable named `spanish2`.

```python
temp_data = pd.read_csv("data/region_lang.csv")
temp_data.shape
```

    (7490, 8)

```python
spanish2 = temp_data.sort_values("most_at_home", ascending=False)[temp_data["language"] == "Spanish"].iloc[1].region
spanish2
```

    /tmp/ipykernel_209923/351870909.py:1: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
      spanish2 = temp_data.sort_values("most_at_home", ascending=False)[temp_data["language"] == "Spanish"].iloc[1].region

    'Toronto'

```python
grader.check("ex2")
```

<p><strong><pre style='display: inline;'>ex2</pre></strong> passed! ðŸ™Œ</p>

## Exercise 3: More Data Wrangling

rubric={accuracy:20}

For this exercise, we want you to choose a Canadian census metropolitan area from the `region_lang` data set you encountered in the previous question and find the top 5 languages spoken most often at home from that area. Your final result should be a data frame with two columns: 1. `language` 2. `perc_pop`.

The column perc_pop should be the percentage of the areaâ€™s population who reported that they speak that language most often at home. You can find the population size for each Canadian census metropolitan area in the file `region_data.csv` located in the `data` directory of this repo.

```python
chosen_region = "Vancouver"
population_data = pd.read_csv("data/region_data.csv")
population = population_data.drop("Unnamed: 0", axis="columns")[population_data["region"] == chosen_region].population
population = int(population)
ex3_data_lang = temp_data.sort_values("most_at_home", ascending=False)[temp_data["region"] == chosen_region].iloc[range(0,5)].language
ex3_data_pop = temp_data.sort_values("most_at_home", ascending=False)[temp_data["region"] == chosen_region].iloc[range(0,5)].most_at_home
ex3_data_pop = ex3_data_pop / population

top_5_vancouver = pd.DataFrame({"language": ex3_data_lang, "perc_pop": ex3_data_pop})
top_5_vancouver
```

    /tmp/ipykernel_209923/767020967.py:4: FutureWarning: Calling int on a single element Series is deprecated and will raise a TypeError in the future. Use int(ser.iloc[0]) instead
      population = int(population)
    /tmp/ipykernel_209923/767020967.py:5: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
      ex3_data_lang = temp_data.sort_values("most_at_home", ascending=False)[temp_data["region"] == chosen_region].iloc[range(0,5)].language
    /tmp/ipykernel_209923/767020967.py:6: UserWarning: Boolean Series key will be reindexed to match DataFrame index.
      ex3_data_pop = temp_data.sort_values("most_at_home", ascending=False)[temp_data["region"] == chosen_region].iloc[range(0,5)].most_at_home

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>language</th>
      <th>perc_pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1923</th>
      <td>English</td>
      <td>0.658730</td>
    </tr>
    <tr>
      <th>4128</th>
      <td>Mandarin</td>
      <td>0.056295</td>
    </tr>
    <tr>
      <th>1048</th>
      <td>Cantonese</td>
      <td>0.053659</td>
    </tr>
    <tr>
      <th>5353</th>
      <td>Punjabi (Panjabi)</td>
      <td>0.042565</td>
    </tr>
    <tr>
      <th>3603</th>
      <td>Korean</td>
      <td>0.013893</td>
    </tr>
  </tbody>
</table>
</div>

## Exercise 4: Tidying Data

rubric={autograde:10}

Letâ€™s load a data set that is not tidy, because it is too wide for the statistical question being asked, and then use pandas to tidy it.

This next data set that we will be looking at contains environmental data from 1914 to 2018. The data was collected by the DFO (Canadaâ€™s Department of Fisheries and Oceans) at the Pacific Biological Station (Departure Bay). Daily sea surface temperatures were recorded. Original data source: http://www.pac.dfo-mpo.gc.ca/science/oceans/data-donnees/lightstations-phares/index-eng.html

A statistical question we might be interested in answering with this data set is, has sea surface temperature been changing over time, and is there an association between time of year (i.e., month) and this change over time? Read the `departure_bay_temperature.csv` data set in from the `data` directory and decide what tidying you will have to do, and then get to work and tidy it!

Assign the the tidy data frame you create to the variable `tidy_temps`. Set the second column name to be `month` & third column name to be `temp`.

```python
dep_bay_data = pd.read_csv("data/departure_bay_temperature.csv", skiprows=2)
tidy_temps = dep_bay_data.set_index("Year").stack().reorder_levels([0,1]).reset_index(name="temp").rename(columns={"level_1":"month"})
```

```python
tidy_temps
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>month</th>
      <th>temp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914</td>
      <td>Jan</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1914</td>
      <td>Sep</td>
      <td>11.1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1914</td>
      <td>Oct</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1171</th>
      <td>2018</td>
      <td>Feb</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1172</th>
      <td>2018</td>
      <td>Mar</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>1173</th>
      <td>2018</td>
      <td>Apr</td>
      <td>8.2</td>
    </tr>
  </tbody>
</table>
<p>1174 rows Ã— 3 columns</p>
</div>

```python
grader.check("ex4")
```

<p><strong><pre style='display: inline;'>ex4</pre></strong> passed! ðŸŽ‰</p>

### Reward: Visualizing the data

Letâ€™s take a look and see whether sea surface temperature been changing over time at Departure Bay, BC. Given that time of year is a factor that influences temperature, weâ€™ll plot this for each month separately:

```python
alt.Chart(tidy_temps).mark_point().encode(
    alt.X('Year:N', axis = alt.Axis(labels=False, ticks = False), title = 'Year', ),
    alt.Y('temp:Q', title= 'Temperature')
).properties(
    width=200,
    height=200
).facet(alt.Facet('month:N', sort = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec']),
    columns = 4
).interactive()
```

## Exercise 5: More Tidying

rubric = {autograde:10}

Use one of the `pandas` functions to tidy the data that you will load in from the `language_diversity.csv` file located in the data directory. This data was collected to answer research questions, such as what factors are associated with language diversity (as measured by the number of languages spoken in a country). Read in the `language_diversity.csv` data set and decide what tidying you will have to do, and then get to work and tidy it! Assign the tidy data frame you create to the variable `tidy_lang`.

```python
lang_div = pd.read_table("data/language_diversity.csv", delimiter="\t")
lang_div
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Continent</th>
      <th>Country</th>
      <th>Measurement</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Africa</td>
      <td>Algeria</td>
      <td>Langs</td>
      <td>18.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Africa</td>
      <td>Angola</td>
      <td>Langs</td>
      <td>42.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Oceania</td>
      <td>Australia</td>
      <td>Langs</td>
      <td>234.00</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>441</th>
      <td>Africa</td>
      <td>Zaire</td>
      <td>Std</td>
      <td>1.90</td>
    </tr>
    <tr>
      <th>442</th>
      <td>Africa</td>
      <td>Zambia</td>
      <td>Std</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>443</th>
      <td>Africa</td>
      <td>Zimbabwe</td>
      <td>Std</td>
      <td>1.43</td>
    </tr>
  </tbody>
</table>
<p>444 rows Ã— 4 columns</p>
</div>

```python
tidy_lang = lang_div.pivot(index=["Continent", "Country"], columns="Measurement", values="Value")
tidy_lang = tidy_lang.reset_index()
tidy_lang


```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Measurement</th>
      <th>Continent</th>
      <th>Country</th>
      <th>Area</th>
      <th>Langs</th>
      <th>MGS</th>
      <th>Population</th>
      <th>Stations</th>
      <th>Std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Africa</td>
      <td>Algeria</td>
      <td>2381741.0</td>
      <td>18.0</td>
      <td>6.60</td>
      <td>25660.0</td>
      <td>102.0</td>
      <td>2.29</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Africa</td>
      <td>Angola</td>
      <td>1246700.0</td>
      <td>42.0</td>
      <td>6.22</td>
      <td>10303.0</td>
      <td>50.0</td>
      <td>1.87</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Africa</td>
      <td>Benin</td>
      <td>112622.0</td>
      <td>52.0</td>
      <td>7.14</td>
      <td>4889.0</td>
      <td>7.0</td>
      <td>0.99</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>71</th>
      <td>Oceania</td>
      <td>Papua New Guinea</td>
      <td>462840.0</td>
      <td>862.0</td>
      <td>10.88</td>
      <td>3772.0</td>
      <td>8.0</td>
      <td>1.96</td>
    </tr>
    <tr>
      <th>72</th>
      <td>Oceania</td>
      <td>Solomon Islands</td>
      <td>28896.0</td>
      <td>66.0</td>
      <td>12.00</td>
      <td>3301.0</td>
      <td>1.0</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>73</th>
      <td>Oceania</td>
      <td>Vanuatu</td>
      <td>12189.0</td>
      <td>111.0</td>
      <td>12.00</td>
      <td>163.0</td>
      <td>4.0</td>
      <td>0.00</td>
    </tr>
  </tbody>
</table>
<p>74 rows Ã— 8 columns</p>
</div>

```python
grader.check("ex5")
```

<p><strong><pre style='display: inline;'>ex5</pre></strong> passed! ðŸŒŸ</p>

### Let's plot!

Now that we have this data in a tidy format, letâ€™s explore it and plot the number of languages spoken in each country in the data set against the countryâ€™s population:

```python
alt.Chart(tidy_lang).mark_point().encode(
    x=alt.X('Population').scale(type="log"),
    y=alt.Y('Langs').scale(type="log"),
    color='Continent:N',
    shape='Continent:N',
).interactive()
```


## Exercise 6 (Challenging)

rubric = {accuracy:5}

(This exercise may be more time consuming than the previous ones. Attempt it only if you finish the previous questions early and want a bit more of a challenge.)

The file `data/beach_data.xlsx` contains data from the Narrabeen beach survey program in Sydney, Australia. The survey program started in the 1970's and has continued to the present day. The survey program is aimed to measure the width of the beach every few weeks. There are five locations along the beach for which measurements are made, from location 1 at the northern end of the beach, to location 5 at the southern end. All the data is available [here](http://narrabeen.wrl.unsw.edu.au/explore_data/time_series/).

Your tasks:

* Determine the largest absolute deviation in width for each beach location in 2010, relative to the mean beach width at that location across all time.
* Determine the standard deviation in width for each beach location in 2010.
* Present the results in a single Data Frame and sort it in descending order of maximum absolute deviation. For example, the corresponding data frame for the year 2011 would look like this:

| Location | Abs Max   | Std       |
| -------- | --------- | --------- |
| 3        | 35.805778 | 13.258404 |
| 4        | 31.611717 | 9.892066  |
| 5        | 26.424559 | 7.463615  |
| 2        | 25.652488 | 8.867712  |
| 1        | 23.943018 | 8.244922  |

```python
beach_data = pd.read_excel("data/beach_data.xlsx", sheet_name="Data")
beach_data_2010 = beach_data[beach_data["Year"] == 2010]
beach_data_2010.head()
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Day</th>
      <th>Month</th>
      <th>Year</th>
      <th>location_1</th>
      <th>location_2</th>
      <th>location_3</th>
      <th>location_4</th>
      <th>location_5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>29</th>
      <td>7</td>
      <td>Oct</td>
      <td>2010</td>
      <td>85.1</td>
      <td>76.4</td>
      <td>71.4</td>
      <td>31.0</td>
      <td>50.5</td>
    </tr>
    <tr>
      <th>58</th>
      <td>10</td>
      <td>Sep</td>
      <td>2010</td>
      <td>84.9</td>
      <td>67.8</td>
      <td>69.1</td>
      <td>36.3</td>
      <td>53.6</td>
    </tr>
    <tr>
      <th>110</th>
      <td>2</td>
      <td>Feb</td>
      <td>2010</td>
      <td>74.1</td>
      <td>58.2</td>
      <td>62.3</td>
      <td>34.1</td>
      <td>52.8</td>
    </tr>
    <tr>
      <th>147</th>
      <td>13</td>
      <td>Jul</td>
      <td>2010</td>
      <td>94.9</td>
      <td>69.4</td>
      <td>89.1</td>
      <td>46.6</td>
      <td>56.2</td>
    </tr>
    <tr>
      <th>176</th>
      <td>2</td>
      <td>Mar</td>
      <td>2010</td>
      <td>75.0</td>
      <td>57.9</td>
      <td>55.5</td>
      <td>35.2</td>
      <td>57.4</td>
    </tr>
  </tbody>
</table>
</div>

```python
loc_data_2010 = beach_data_2010[["location_1","location_2", "location_3", "location_4", "location_5"]]
loc = ["location_1","location_2", "location_3", "location_4", "location_5"]
loc_data = beach_data[["location_1","location_2", "location_3", "location_4", "location_5"]]
loc_abs_max = []
for i in range(0,5):
    loc_mean = loc_data.mean()
    loc_abs_max.append(max(abs(loc_data_2010[loc[i]] - loc_mean[loc[i]])))

loc_abs_max
```

    [21.54301765650081,
     18.752487961476717,
     24.105778491171733,
     24.711717495987163,
     17.02455858747993]

```python
beach_data_std = beach_data_2010[["location_1","location_2", "location_3", "location_4", "location_5"]].std()
beach_data_std
```

    location_1    8.111099
    location_2    7.595573
    location_3    9.711458
    location_4    6.802155
    location_5    5.707325
    dtype: float64

```python
beach_data_final = pd.DataFrame({"Abs Max": loc_abs_max, "Std":beach_data_std}).sort_values(by = "Abs Max", ascending=False)
beach_data_final
```

<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }`</style>`

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Abs Max</th>
      <th>Std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>location_4</th>
      <td>24.711717</td>
      <td>6.802155</td>
    </tr>
    <tr>
      <th>location_3</th>
      <td>24.105778</td>
      <td>9.711458</td>
    </tr>
    <tr>
      <th>location_1</th>
      <td>21.543018</td>
      <td>8.111099</td>
    </tr>
    <tr>
      <th>location_2</th>
      <td>18.752488</td>
      <td>7.595573</td>
    </tr>
    <tr>
      <th>location_5</th>
      <td>17.024559</td>
      <td>5.707325</td>
    </tr>
  </tbody>
</table>
</div>

**Congratulations!** You are done the lab!!! Pat yourself on the back, convert the notebook to PDF and submit your lab to **GitHub** and Gradescope! Make sure you have 3 Git commits!